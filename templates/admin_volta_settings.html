{% extends "base.html" %}

{% block title %}Volta Settings - Admin{% endblock %}

<style>
    /* Dark Mode Styles for Volta Settings */
    body.dark-mode .card {
        background-color: var(--dark-bg-secondary) !important;
        border-color: var(--dark-border) !important;
    }
    
    body.dark-mode .card-header {
        background-color: var(--dark-bg-tertiary) !important;
        border-color: var(--dark-border) !important;
        color: var(--dark-text) !important;
    }
    
    body.dark-mode .card-header.bg-primary {
        background-color: var(--accent-primary) !important;
        color: white !important;
    }
    
    body.dark-mode .card-header.bg-primary h5 {
        color: white !important;
    }
    
    body.dark-mode .card-body {
        color: var(--dark-text) !important;
    }
    
    body.dark-mode .card-title,
    body.dark-mode h5.card-title,
    body.dark-mode h6 {
        color: var(--dark-text) !important;
    }
    
    body.dark-mode .bg-light {
        background-color: var(--dark-bg-tertiary) !important;
        color: var(--dark-text) !important;
        border-color: var(--dark-border) !important;
    }
    
    body.dark-mode pre {
        color: #7ec699 !important;
        background-color: var(--dark-bg) !important;
        border: 1px solid var(--dark-border) !important;
        white-space: pre-wrap;
    }
    
    body.dark-mode code {
        color: #f8b500 !important;
        background-color: rgba(79, 159, 240, 0.1) !important;
        padding: 2px 6px;
        border-radius: 4px;
    }
    
    body.dark-mode .alert-info {
        background-color: rgba(79, 159, 240, 0.1) !important;
        border-color: var(--accent-primary) !important;
        color: var(--dark-text) !important;
    }
    
    body.dark-mode .alert-info .alert-heading {
        color: var(--accent-primary) !important;
    }
    
    body.dark-mode .alert-warning {
        background-color: rgba(237, 137, 54, 0.1) !important;
        border-color: var(--accent-warning) !important;
        color: var(--dark-text) !important;
    }
    
    body.dark-mode .alert-warning .alert-heading {
        color: var(--accent-warning) !important;
    }
    
    body.dark-mode .alert-danger {
        background-color: rgba(245, 101, 101, 0.1) !important;
        border-color: var(--accent-danger) !important;
        color: var(--dark-text) !important;
    }
    
    body.dark-mode .alert-danger .alert-heading {
        color: var(--accent-danger) !important;
    }
    
    body.dark-mode .alert a {
        color: var(--accent-primary) !important;
        text-decoration: underline;
    }
    
    body.dark-mode .alert a:hover {
        color: #7ebcde !important;
    }
    
    body.dark-mode .alert-light {
        background-color: var(--dark-bg-tertiary) !important;
        border-color: var(--dark-border) !important;
        color: var(--dark-text) !important;
    }
    
    body.dark-mode .text-muted {
        color: var(--dark-text-muted) !important;
    }
    
    body.dark-mode .badge {
        font-weight: 600;
    }
    
    body.dark-mode ol li {
        color: var(--dark-text) !important;
    }
    
    body.dark-mode ul li {
        color: var(--dark-text) !important;
    }
    
    body.dark-mode .border-primary {
        border-color: var(--accent-primary) !important;
    }
    
    body.dark-mode .bg-light.border {
        background-color: var(--dark-bg-tertiary) !important;
        border-color: var(--dark-border) !important;
    }
    
    body.dark-mode .list-unstyled li {
        color: var(--dark-text) !important;
        margin-bottom: 8px;
    }
    
    body.dark-mode .badge {
        text-transform: uppercase;
        font-size: 0.8em;
    }
</style>

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2">
        <i class="bi bi-robot"></i> Volta Chatbot Control Panel
    </h1>
    <a href="{{ url_for('admin_products') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Products
    </a>
</div>

<!-- Status Badge -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card border-0">
            <div class="card-body text-center">
                {% if config.enabled %}
                <i class="bi bi-check-circle display-1 text-success mb-3"></i>
                <h5 class="card-title">Volta is Awake</h5>
                <p class="text-muted">Chatbot is active and responding</p>
                <span class="badge bg-success">ENABLED</span>
                {% else %}
                <i class="bi bi-moon display-1 text-warning mb-3"></i>
                <h5 class="card-title">Volta is Sleeping</h5>
                <p class="text-muted">Chatbot is in maintenance mode</p>
                <span class="badge bg-warning">DISABLED</span>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0">
            <div class="card-body text-center">
                {% if api_key_set %}
                <i class="bi bi-key-fill display-1 text-info mb-3"></i>
                <h5 class="card-title">API Key Set</h5>
                <p class="text-muted">Google Gemini API configured</p>
                <span class="badge bg-info">CONFIGURED</span>
                {% else %}
                <i class="bi bi-exclamation-circle display-1 text-danger mb-3"></i>
                <h5 class="card-title">No API Key</h5>
                <p class="text-muted">Volta cannot function without it</p>
                <span class="badge bg-danger">NOT SET</span>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0 bg-light">
            <div class="card-body text-center">
                <i class="bi bi-file-text display-1 text-secondary mb-3"></i>
                <h5 class="card-title">API Key Source</h5>
                <p class="text-muted">Stored in .env file</p>
                <span class="badge bg-secondary">ENVIRONMENT</span>
            </div>
        </div>
    </div>
</div>

<!-- Main Settings Card -->
<div class="card">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-sliders"></i> Chatbot Settings</h5>
    </div>
    <div class="card-body">
        <!-- API Key Management -->
        <div class="row mb-4">
            <div class="col-md-8">
                <h6 class="mb-3">Google Gemini API Key Configuration</h6>
                
                <!-- API Key Input Form -->
                <form method="POST" action="{{ url_for('volta_settings') }}" class="mb-3" id="apiKeyForm">
                    <div class="form-group mb-3">
                        <label for="apiKey" class="form-label"><i class="bi bi-key-fill"></i> Enter API Key</label>
                        <div class="input-group">
                            <input type="password" 
                                   class="form-control" 
                                   id="apiKey" 
                                   name="api_key" 
                                   placeholder="Paste your Google Gemini API key here"
                                   required>
                            <button type="button" class="btn btn-outline-secondary" id="toggleApiKey">
                                <i class="bi bi-eye"></i> Show
                            </button>
                        </div>
                        <small class="form-text text-muted d-block mt-2">
                            Get your free API key from <a href="https://aistudio.google.com/app/apikey" target="_blank" class="fw-bold">Google AI Studio</a>
                        </small>
                    </div>
                    
                    <input type="hidden" name="action" value="update_api_key">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle"></i> Save API Key
                    </button>
                </form>
                
                <!-- API Key Status -->
                <div class="alert alert-info">
                    <h6 class="alert-heading"><i class="bi bi-info-circle"></i> API Key Status</h6>
                    <p class="mb-2"><strong>Current Status:</strong>
                        {% if api_key_set %}
                        <span class="badge bg-success">✓ API Key Configured</span>
                        {% else %}
                        <span class="badge bg-danger">✗ API Key Not Configured</span>
                        {% endif %}
                    </p>
                    <p class="mb-0"><small>The API key is used to communicate with Google's Gemini AI model. Without it, Volta cannot respond to messages.</small></p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="alert alert-warning mb-0">
                    <h6 class="alert-heading"><i class="bi bi-exclamation-triangle"></i> Important</h6>
                    <ul class="mb-0">
                        <li>Never commit .env file to git</li>
                        <li>Keep API key private and secure</li>
                        <li>Use environment variables for production</li>
                        <li>Free tier available at Google</li>
                    </ul>
                </div>
            </div>
        </div>

        <hr>

        <!-- Enable/Disable Volta -->
        <div class="row mb-4">
            <div class="col-md-8">
                <h6 class="mb-3">Volta Status Control</h6>
                <p class="text-muted mb-3">
                    {% if config.enabled %}
                    Volta is currently <strong>ACTIVE</strong>. Users can chat with the bot.
                    {% else %}
                    Volta is currently <strong>SLEEPING (Maintenance Mode)</strong>. Users will see a maintenance message.
                    {% endif %}
                </p>
                <form method="POST" action="{{ url_for('volta_settings') }}" class="d-inline">
                    <input type="hidden" name="action" value="toggle_status">
                    {% if config.enabled %}
                    <button type="submit" class="btn btn-warning">
                        <i class="bi bi-moon"></i> Put Volta to Sleep
                    </button>
                    {% else %}
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-check-circle"></i> Wake Up Volta
                    </button>
                    {% endif %}
                </form>
            </div>
            <div class="col-md-4">
                <div class="alert alert-warning mb-0">
                    <h6 class="alert-heading">Maintenance Mode</h6>
                    <ul class="mb-0">
                        <li>Use to disable chatbot temporarily</li>
                        <li>Users see "Volta is sleeping" message</li>
                        <li>No data is lost</li>
                        <li>Easy to re-enable anytime</li>
                    </ul>
                </div>
            </div>
        </div>

        <hr>

        <!-- Reset Configuration -->
        <div class="row">
            <div class="col-md-8">
                <h6 class="mb-3">Reset Configuration</h6>
                <p class="text-muted mb-3">
                    Clear all Volta settings and restore defaults. The API key must be reconfigured in the .env file.
                </p>
                <form method="POST" action="{{ url_for('volta_settings') }}" 
                      onsubmit="return confirm('Are you sure? This will reset all Volta settings.');">
                    <input type="hidden" name="action" value="reset_config">
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-arrow-clockwise"></i> Reset Configuration
                    </button>
                </form>
            </div>
            <div class="col-md-4">
                <div class="alert alert-danger mb-0">
                    <h6 class="alert-heading">Warning</h6>
                    <ul class="mb-0">
                        <li>This action cannot be undone</li>
                        <li>Volta will be disabled</li>
                        <li>All settings will be reset</li>
                        <li>Confirm carefully</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Prompt Card -->
<div class="card mt-4">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-chat-left-text"></i> Volta System Prompt</h5>
    </div>
    <div class="card-body">
        <p class="text-muted mb-3">This is the system instruction that guides Volta's responses:</p>
        <div class="alert alert-light border" style="max-height: 300px; overflow-y: auto;">
            <pre style="margin: 0; white-space: pre-wrap;">{{ config.system_prompt }}</pre>
        </div>
        <small class="text-muted">
            <i class="bi bi-info-circle"></i> The system prompt ensures Volta only responds to IoT, AI/ML, Cyber Security, and CSE topics.
        </small>
    </div>
</div>

<!-- Usage Statistics -->
<div class="card mt-4">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-graph-up"></i> Chatbot Information</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h6>Specializations</h6>
                <ul class="list-unstyled">
                    <li><span class="badge bg-primary">IoT</span> Internet of Things & Smart Devices</li>
                    <li><span class="badge bg-success">AI/ML</span> Artificial Intelligence & Machine Learning</li>
                    <li><span class="badge bg-warning">Security</span> Cyber Security & Protection</li>
                    <li><span class="badge bg-info">CSE</span> Computer Science Engineering</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h6>Model Information</h6>
                <ul class="list-unstyled">
                    <li><strong>Model:</strong> Google Gemini 2.5 Flash</li>
                    <li><strong>Type:</strong> AI Language Model</li>
                    <li><strong>Response Time:</strong> ~2-5 seconds</li>
                    <li><strong>Availability:</strong> Public API</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Quick Start Guide -->
<div class="card mt-4 bg-light border-primary">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-lightbulb"></i> Quick Start Guide</h5>
    </div>
    <div class="card-body">
        <ol>
            <li><strong>Get API Key:</strong> Visit <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a> and create a free API key</li>
            <li><strong>Create .env file:</strong> Create a <code>.env</code> file in the project root if it doesn't exist</li>
            <li><strong>Add API Key:</strong> Add <code>GEMINI_API_KEY=your_key_here</code> to the <code>.env</code> file</li>
            <li><strong>Restart Server:</strong> Restart the Flask application to load the new environment variable</li>
            <li><strong>Test:</strong> Visit <a href="{{ url_for('chat') }}">/chat</a> and start talking to Volta</li>
            <li><strong>Manage:</strong> Use the toggle below to enable/disable Volta anytime</li>
        </ol>
    </div>
</div>


<style>
.card {
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: box-shadow 0.3s;
}

.card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.card-header {
    border-radius: 12px 12px 0 0;
}

.badge {
    font-size: 0.9em;
    padding: 0.5em 0.75em;
}

#apiKey {
    font-family: 'Courier New', monospace;
    letter-spacing: 0.05em;
}

.form-label {
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.input-group .btn-outline-secondary {
    border-color: #dee2e6;
}

.input-group .btn-outline-secondary:hover {
    background-color: transparent;
}

body.dark-mode #apiKey {
    background-color: var(--dark-bg-tertiary) !important;
    color: var(--dark-text) !important;
    border-color: var(--dark-border) !important;
}

body.dark-mode #apiKey::placeholder {
    color: var(--dark-text-muted) !important;
}

body.dark-mode #apiKey:focus {
    border-color: var(--accent-primary) !important;
    box-shadow: 0 0 0 0.2rem rgba(79, 159, 240, 0.25) !important;
}

body.dark-mode .form-label {
    color: var(--dark-text) !important;
}

body.dark-mode .input-group .btn-outline-secondary {
    border-color: var(--dark-border) !important;
    color: var(--dark-text) !important;
}

body.dark-mode .input-group .btn-outline-secondary:hover {
    background-color: rgba(79, 159, 240, 0.1) !important;
    border-color: var(--accent-primary) !important;
    color: var(--accent-primary) !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Toggle API Key visibility
    const toggleBtn = document.getElementById('toggleApiKey');
    if (toggleBtn) {
        toggleBtn.addEventListener('click', function(e) {
            e.preventDefault();
            const apiKeyField = document.getElementById('apiKey');
            const btn = this;
            
            if (apiKeyField.type === 'password') {
                apiKeyField.type = 'text';
                btn.innerHTML = '<i class="bi bi-eye-slash"></i> Hide';
            } else {
                apiKeyField.type = 'password';
                btn.innerHTML = '<i class="bi bi-eye"></i> Show';
            }
        });
    }
    
    // Prevent form disappearance on submission
    const apiKeyForm = document.getElementById('apiKeyForm');
    if (apiKeyForm) {
        apiKeyForm.addEventListener('submit', function(e) {
            // Form will submit normally and page will reload with status
            // This prevents any JavaScript from hiding the form
        });
    }
});
</script>
{% endblock %}
